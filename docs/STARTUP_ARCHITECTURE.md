# TempleOS Start-up Architecture & ISO Notes

**Autogenerated**: 2026-01-01
**Critical Context for Future AI Agents**: This document explains the "Single Source of Truth" strategy for system startup.

## 1. The Master Startup Script
The file `/opt/templeos/start-templeos.sh` is the **ONLY** correct way to launch the TempleOS session.

**It handles:**
1.  **Openbox**: Launches window manager with correct config.
2.  **Resolution**: Forces 1024x768 (critical for VirtualBox).
3.  **Keybind Daemon**: Starts `scripts/keybind-daemon.py` (Global hotkeys, Ctrl+Alt+Arrows).
4.  **Electron**: Execs the main application shell.

## 2. ISO vs Local Environment

We have unified the boot process so it works identically in both "Production" (ISO) and "Development" (Local VM) modes.

### A. ISO (Production)
- **Method**: Systemd Service (`/etc/systemd/system/templeos.service`).
- **Config**: Defined in `docs/iso-build-guide.md` step "Create Autostart".
- **Validation**: MUST use `ExecStart=/opt/templeos/start-templeos.sh`.
  - *Do NOT exec electron directly!* (This would bypass the keybind daemon).

### B. Local VM (Development)
- **Method**: `.xinitrc` (invoked by `startx`).
- **Config**: Generated by `scripts/setup-x11-openbox.sh`.
- **Validation**: The setup script generates an `.xinitrc` that delegates to the master script:
  ```bash
  exec /opt/templeos/start-templeos.sh
  ```

## 3. Important Gotchas

### Do NOT run setup scripts with `sudo`
When running `scripts/setup-x11-openbox.sh`, use:
- **CORRECT**: `bash ./scripts/setup-x11-openbox.sh`
- **WRONG**: `sudo ./scripts/setup-x11-openbox.sh`

**Why?** Running with sudo changes `$HOME` to `/root`, so it writes the startup files to `/root/.xinitrc` instead of the user's home directory. The script calls `sudo` internally where needed.

### Keybind Daemon
- Defined in `scripts/keybind-daemon.py`.
- **Autostart**: Handled by `start-templeos.sh`.
- **Dependencies**: Requires `wmctrl`, `xdotool`, and `python3`.
- **Permissions**: User must be in `input` group (handled by `scripts/setup-keybinds.sh` or the pre-configured ISO environment).

## 4. Updates
If you modify startup logic (e.g. adding a new daemon), add it to `start-templeos.sh`. Do NOT add it to `.xinitrc` or `systemd` files directly, or the environments will drift apart.
